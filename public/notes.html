<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
        integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <title>Note Taker</title>
</head>

<body>
    <div class="jumbotron">Note Taker</div>
    <!-- Form control to enter a new note -->
    <div class="container">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-save text-primary"></i> Save a Note:
            </div>
            <div class="card-body">
                <div class="form-group">
                    <input type="text" class="form-control" id="noteTitle" placeholder="Note Title">
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" id="noteBody" placeholder="Enter Note Text">
                </div>
            </div>
            <div class="card-footer">
                <button id="save-btn" type="button" class="btn btn-primary float-right">Save Note</button>
            </div>
        </div>
        <br>
        <!-- Secton to list all notes and option to delete -->

        <div class="card">
            <div class="card-header">
                <i class="fas fa-clipboard-list text-primary"></i> My Notes:
            </div>
            <div class="card-body">
                <ul class="list-group">
                    <div id="notesInfo">
                    </div>
                </ul>
            </div>
            <div class="card-footer">
                <p><span id="countnotes"></span> notes listed</p>
            </div>
        </div>
    </div>

    <script type="text/javascript">

        var faTrash = "<i class=\"fas fa-trash-alt float-right text-danger\">";
        var faNotes = "<i class=\"fas fa-sticky-note text-info\"></i>";

        var liStartNoteTitle = "<li class=\"list-group-item\"> ";
        liStartNoteTitle += "<span class=\"font-weight-bold\">";
        liStartNoteTitle += "<i class=\"fas fa-sticky-note text-info\"></i>";
        var liEndNoteTitle = "</span>";
        var liStartNoteBody = "<p>";
        var liEndNoteBody = "</p></li>";
        $.get("/api/allnotes", function (data) {
            console.log(data);
            if (data) {
                $("#noteInfo").show();
                for (var i = 0; i < data.length; i++) {
                    var delItem = "<i id=" + data[i].id + " class=\"fas fa-trash-alt float-right text-danger\"></i>"
                    var noteTitle = liStartNoteTitle + data[i].title + liEndNoteTitle + delItem;
                    noteTitle += liStartNoteBody + data[i].body + liEndNoteBody;
                    $("#notesInfo").append(noteTitle);
                }
            } else {
                $("#noteInfo").text(
                    "The force is not strong with this one. Your character was not found.");
                $("#notesInfo").hide();
            }
        });

        $.get("/api/countnotes", function (data) {
            console.log(data);
            if (data) {
                var countNotes = data[0].numnotes;
                $("#countnotes").text(countNotes);
            } else {
                $("#noteInfo").text(
                    "The force is not strong with this one. Your character was not found.");
                $("#notesInfo").hide();
            }
        });

        $(document).on("click", ".fa-trash-alt", function () {
            //   var topicSelected = $(this).attr("data-name");
            // alert($(this).attr("data-name"));
            var delNoteId = $(this).attr("id");

            $.get("/api/delete/" + delNoteId, function (data) {
                console.log(data);
                if (data) {
                    alert("Note " + delNoteId + " deleted.")
                } else {
                    alert("Note " + delNoteId + " not found.")
                }
                location.reload();
            });
        });

        $("#save-btn").on("click", function (event) {
            event.preventDefault();
            var newNote = {
                title: $("#noteTitle").val().trim(),
                body: $("#noteBody").val().trim()
            };

            $.post("/api/add", newNote)
                .then(function (data) {
                    console.log("add.html", data);
                    // alert("Adding note...");
                    location.reload();
                });
        });
    </script>
</body>

</html>